лабораторная работа 9
тема работы: реализация crud-операций и изучение принципов mvc на примере приложения для отслеживания курсов валют.

цель работы
целью данной лабораторной работы является получение практических навыков разработки простого веб-приложения с использованием архитектуры mvc.
в ходе работы требовалось реализовать основные crud-операции (создание, чтение, обновление и удаление данных), освоить работу с базой данных sqlite в памяти (:memory:), а также понять, как используются первичные и внешние ключи для организации связей между таблицами.
также целью работы было разделить код на логические части (модели, контроллеры и представления), реализовать обработку http-запросов и отображение данных в браузере с помощью html-шаблонов.

1. описание моделей, их свойств и связей
в приложении используются три основные сущности: пользователь, валюта и связь пользователь-валюта. данные сущности хранятся в базе данных sqlite и представлены в виде отдельных таблиц.

1.1 модели данных
user - представляет пользователя системы.
каждый пользователь имеет:
id это уникальный идентификатор пользователя (первичный ключ);
name это имя пользователя.

currency представляет валюту и ее курс.
у валюты есть следующие поля:
id - уникальный идентификатор валюты (первичный ключ);
num_code - числовой код валюты;
char_code - символьный код валюты (например, usd);
name - название валюты;
value - текущий курс валюты;
nominal - номинал валюты.
user_currency - вспомогательная таблица, которая используется для хранения подписок пользователей на валюты.
она содержит:
id - уникальный идентификатор записи;
user_id - ссылка на пользователя;
currency_id - ссылка на валюту.

1.2 описание связей

связь между пользователями и валютами реализована как связь «многие-ко-многим».
это означает, что один пользователь может отслеживать несколько валют, а одна валюта может быть отслежена несколькими пользователями.
для этого используется отдельная таблица user_currency, в которой:
user_id является внешним ключом и ссылается на user.id;
currency_id является внешним ключом и ссылается на currency.id.
первичные ключи используются для уникальной идентификации записей, а внешние ключи - для обеспечения корректных связей между таблицами.

2. структура проекта с назначением файлов
проект реализован с использованием архитектуры mvc, что позволяет разделить код по назначению и упростить его понимание.
структура проекта выглядит следующим образом:

myapp.py
controllers/
    databasecontroller.py
    currencycontroller.py
    usercontroller.py
    usercurrencycontroller.py
    pages.py
utils/
    currencies_cbapi.py
templates/
    base.html
    index.html
    currencies.html
    users.html
    user.html
    author.html


назначение файлов:
myapp.py - главный файл приложения, в котором запускается сервер и обрабатываются маршруты;
databasecontroller.py - отвечает за подключение к sqlite и выполнение sql-запросов;
currencycontroller.py - реализует crud-операции для валют;
usercontroller.py - реализует crud-операции для пользователей;
usercurrencycontroller.py - отвечает за подписки пользователей на валюты;
pages.py - выполняет рендеринг html-шаблонов;
currencies_cbapi.py - имитирует внешний api для обновления курсов валют;
папка templates содержит html-шаблоны пользовательского интерфейса.

3. реализация crud с примерами sql-запросов
все операции с базой данных выполняются через контроллер базы данных с использованием параметризованных запросов.

3.1 create (создание)

пример создания валюты:
insert into currency values(null, ?, ?, ?, ?, ?)


пример создания пользователя:
insert into user values(null, ?)

3.2 read (чтение)

получение списка всех валют:

select * from currency order by id


получение валют, на которые подписан пользователь:

select c.*
from currency c
join user_currency uc on uc.currency_id = c.id
where uc.user_id = ?

3.3 update 

обновление данных валюты:

update currency set value = ? where id = ?


обновление имени пользователя:

update user set name = ? where id = ?

3.4 delete (удаление)

удаление валюты:

delete from currency where id = ?


удаление пользователя:

delete from user_currency where user_id = ?
delete from user where id = ?

4. примеры тестов с unittest.mock

для проверки корректности работы контроллеров использовался модуль unittest.mock.
это позволяет тестировать логику приложения без реального подключения к базе данных.

пример теста создания валюты:

def test_create_currency(self):
    self.mock_db.execute.return_value = 5
    currency_id = self.controller.create_currency('980', 'uah', 'гривна', 2.3, 1)
    self.assertEqual(currency_id, 5)


результаты выполнения тестов показывают, что контроллеры корректно формируют запросы и взаимодействуют с базой данных.

5. выводы

в ходе выполнения лабораторной работы было разработано простое веб-приложение для работы с валютами и пользователями.
в процессе работы удалось на практике применить архитектуру mvc, разобраться с работой sqlite в памяти и реализовать crud-операции.
также были получены навыки обработки http-запросов, работы с html-формами и использования шаблонизатора jinja2 для отображения данных в браузере.
поставленные цели лабораторной работы были выполнены, а полученные знания могут быть использованы при разработке более сложных веб-приложений.
